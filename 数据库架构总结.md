# æ•°æ®åº“æ¶æ„æ€»ç»“

## ğŸ“Š æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è¯´å”±ä¸“è¾‘è®ºå›é¡¹ç›®æ•°æ®åº“æ¶æ„çš„å®Œæ•´æ€»ç»“ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ã€å…³ç³»ã€ç´¢å¼•å’Œå…³é”®åŠŸèƒ½ã€‚

## ğŸ—„ï¸ æ•°æ®è¡¨è¯¦æƒ…

### 1. users (ç”¨æˆ·è¡¨)

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·çš„æ‰©å±•ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | ç”¨æˆ·ID |
| auth_id | UUID | FK â†’ auth.users | å…³è”Supabase Auth |
| username | VARCHAR(50) | UNIQUE, NOT NULL | ç”¨æˆ·åï¼ˆ3å­—ç¬¦ä»¥ä¸Šï¼‰ |
| email | VARCHAR(255) | UNIQUE, NOT NULL | é‚®ç®± |
| avatar | TEXT | NULL | å¤´åƒURL |
| bio | TEXT | NULL | ä¸ªäººç®€ä»‹ |
| role | VARCHAR(20) | DEFAULT 'user' | è§’è‰²: user/admin |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_users_auth_id` - auth_id
- `idx_users_username` - username
- `idx_users_email` - email
- `idx_users_created_at` - created_at DESC

**å…³ç³»**:
- â†’ album_ratings, album_comments, posts, post_replies, favorites, notifications

---

### 2. albums (ä¸“è¾‘è¡¨)

**ç”¨é€”**: å­˜å‚¨è¯´å”±ä¸“è¾‘ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | ä¸“è¾‘ID |
| title | VARCHAR(255) | NOT NULL | ä¸“è¾‘æ ‡é¢˜ |
| artist | VARCHAR(255) | NOT NULL | è‰ºäººåç§° |
| cover_url | TEXT | NOT NULL | å°é¢URL |
| release_date | DATE | NOT NULL | å‘è¡Œæ—¥æœŸ |
| genre | VARCHAR(100) | NOT NULL | éŸ³ä¹æµæ´¾ |
| description | TEXT | NULL | ä¸“è¾‘ä»‹ç» |
| artist_bio | TEXT | NULL | è‰ºäººç®€ä»‹ |
| rating | DECIMAL(3,2) | DEFAULT 0, 0-5 | å¹³å‡è¯„åˆ† |
| rating_count | INTEGER | DEFAULT 0 | è¯„åˆ†äººæ•° |
| song_count | INTEGER | DEFAULT 0 | æ­Œæ›²æ•°é‡ |
| preview_url | TEXT | NULL | é¢„è§ˆéŸ³é¢‘URL |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_albums_artist` - artist
- `idx_albums_genre` - genre
- `idx_albums_release_date` - release_date DESC
- `idx_albums_rating` - rating DESC
- `idx_albums_title` - GINå…¨æ–‡ç´¢å¼•
- `idx_albums_created_at` - created_at DESC

**å…³ç³»**:
- â†’ songs, album_ratings, album_comments, favorites, posts.related_album_id

**è‡ªåŠ¨æ›´æ–°**:
- `rating` å’Œ `rating_count` ç”±è§¦å‘å™¨è‡ªåŠ¨è®¡ç®—
- `song_count` ç”±è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°

---

### 3. songs (æ­Œæ›²è¡¨)

**ç”¨é€”**: å­˜å‚¨ä¸“è¾‘ä¸­çš„æ­Œæ›²ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | æ­Œæ›²ID |
| album_id | UUID | FK â†’ albums, NOT NULL | æ‰€å±ä¸“è¾‘ |
| title | VARCHAR(255) | NOT NULL | æ­Œæ›²æ ‡é¢˜ |
| track_number | INTEGER | NOT NULL, >0 | æ›²ç›®ç¼–å· |
| duration | INTEGER | NOT NULL, >0 | æ—¶é•¿ï¼ˆç§’ï¼‰ |
| audio_url | TEXT | NOT NULL | éŸ³é¢‘URL |
| lyrics | TEXT | NULL | æ­Œè¯ |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**çº¦æŸ**:
- UNIQUE(album_id, track_number) - æ¯ä¸ªä¸“è¾‘çš„æ›²ç›®ç¼–å·å”¯ä¸€

**ç´¢å¼•**:
- `idx_songs_album_id` - album_id
- `idx_songs_track_number` - (album_id, track_number)
- `idx_songs_title` - GINå…¨æ–‡ç´¢å¼•

**å…³ç³»**:
- â† albums (å¤šå¯¹ä¸€)

---

### 4. album_ratings (ä¸“è¾‘è¯„åˆ†è¡¨)

**ç”¨é€”**: ç”¨æˆ·å¯¹ä¸“è¾‘çš„è¯„åˆ†

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | è¯„åˆ†ID |
| user_id | UUID | FK â†’ users, NOT NULL | ç”¨æˆ· |
| album_id | UUID | FK â†’ albums, NOT NULL | ä¸“è¾‘ |
| score | INTEGER | NOT NULL, 1-5 | è¯„åˆ†ï¼ˆæ˜Ÿçº§ï¼‰ |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**çº¦æŸ**:
- UNIQUE(user_id, album_id) - æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªä¸“è¾‘åªèƒ½è¯„ä¸€æ¬¡åˆ†

**ç´¢å¼•**:
- `idx_album_ratings_user_id` - user_id
- `idx_album_ratings_album_id` - album_id
- `idx_album_ratings_score` - score
- `idx_album_ratings_created_at` - created_at DESC

**è§¦å‘å™¨**:
- æ’å…¥/æ›´æ–°/åˆ é™¤æ—¶è‡ªåŠ¨æ›´æ–° albums è¡¨çš„ rating å’Œ rating_count

---

### 5. album_comments (ä¸“è¾‘è¯„è®ºè¡¨)

**ç”¨é€”**: ç”¨æˆ·å¯¹ä¸“è¾‘çš„è¯„è®ºå’Œå›å¤

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | è¯„è®ºID |
| user_id | UUID | FK â†’ users, NOT NULL | ç”¨æˆ· |
| album_id | UUID | FK â†’ albums, NOT NULL | ä¸“è¾‘ |
| content | TEXT | NOT NULL | è¯„è®ºå†…å®¹ |
| parent_id | UUID | FK â†’ album_comments | çˆ¶è¯„è®ºID |
| likes | INTEGER | DEFAULT 0 | ç‚¹èµæ•° |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_album_comments_user_id` - user_id
- `idx_album_comments_album_id` - album_id
- `idx_album_comments_parent_id` - parent_id
- `idx_album_comments_created_at` - created_at DESC
- `idx_album_comments_likes` - likes DESC

**ç‰¹æ€§**:
- æ”¯æŒåµŒå¥—è¯„è®ºï¼ˆæ¥¼ä¸­æ¥¼ï¼‰
- parent_id ä¸º NULL è¡¨ç¤ºé¡¶çº§è¯„è®º

---

### 6. forum_categories (è®ºå›ç‰ˆå—è¡¨)

**ç”¨é€”**: è®ºå›çš„åˆ†ç±»ç‰ˆå—

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | ç‰ˆå—ID |
| name | VARCHAR(100) | UNIQUE, NOT NULL | ç‰ˆå—åç§° |
| description | TEXT | NULL | ç‰ˆå—æè¿° |
| icon | TEXT | NULL | ç‰ˆå—å›¾æ ‡ |
| sort_order | INTEGER | DEFAULT 0 | æ’åºé¡ºåº |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_forum_categories_sort_order` - sort_order

**é¢„è®¾æ•°æ®**:
1. ä¸“è¾‘è®¨è®º ğŸµ
2. æ­Œæ›²æ•…äº‹ ğŸ“–
3. è¯´å”±æ–‡åŒ– ğŸ¤
4. æ–°äººæ¨è â­
5. ç«™åŠ¡å…¬å‘Š ğŸ“¢

---

### 7. posts (å¸–å­è¡¨)

**ç”¨é€”**: è®ºå›å¸–å­

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | å¸–å­ID |
| user_id | UUID | FK â†’ users, NOT NULL | å‘å¸–ç”¨æˆ· |
| category_id | UUID | FK â†’ forum_categories | æ‰€å±ç‰ˆå— |
| title | VARCHAR(255) | NOT NULL | å¸–å­æ ‡é¢˜ |
| content | TEXT | NOT NULL | å¸–å­å†…å®¹ |
| related_album_id | UUID | FK â†’ albums | å…³è”ä¸“è¾‘ |
| reply_count | INTEGER | DEFAULT 0 | å›å¤æ•°é‡ |
| likes | INTEGER | DEFAULT 0 | ç‚¹èµæ•° |
| is_pinned | BOOLEAN | DEFAULT FALSE | æ˜¯å¦ç½®é¡¶ |
| is_highlighted | BOOLEAN | DEFAULT FALSE | æ˜¯å¦ç²¾å |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_posts_user_id` - user_id
- `idx_posts_category_id` - category_id
- `idx_posts_related_album_id` - related_album_id
- `idx_posts_created_at` - created_at DESC
- `idx_posts_is_pinned` - (is_pinned, created_at DESC)
- `idx_posts_is_highlighted` - (is_highlighted, created_at DESC)
- `idx_posts_title` - GINå…¨æ–‡ç´¢å¼•
- `idx_posts_content` - GINå…¨æ–‡ç´¢å¼•

**è‡ªåŠ¨æ›´æ–°**:
- `reply_count` ç”±è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°

---

### 8. post_replies (å¸–å­å›å¤è¡¨)

**ç”¨é€”**: å¯¹å¸–å­çš„å›å¤

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | å›å¤ID |
| post_id | UUID | FK â†’ posts, NOT NULL | æ‰€å±å¸–å­ |
| user_id | UUID | FK â†’ users, NOT NULL | å›å¤ç”¨æˆ· |
| content | TEXT | NOT NULL | å›å¤å†…å®¹ |
| parent_id | UUID | FK â†’ post_replies | çˆ¶å›å¤ID |
| likes | INTEGER | DEFAULT 0 | ç‚¹èµæ•° |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `idx_post_replies_post_id` - post_id
- `idx_post_replies_user_id` - user_id
- `idx_post_replies_parent_id` - parent_id
- `idx_post_replies_created_at` - created_at DESC
- `idx_post_replies_likes` - likes DESC

**ç‰¹æ€§**:
- æ”¯æŒæ¥¼ä¸­æ¥¼å›å¤
- è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°å¸–å­çš„å›å¤æ•°

---

### 9. favorites (æ”¶è—è¡¨)

**ç”¨é€”**: ç”¨æˆ·æ”¶è—çš„ä¸“è¾‘

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | æ”¶è—ID |
| user_id | UUID | FK â†’ users, NOT NULL | ç”¨æˆ· |
| album_id | UUID | FK â†’ albums, NOT NULL | ä¸“è¾‘ |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | æ”¶è—æ—¶é—´ |

**çº¦æŸ**:
- UNIQUE(user_id, album_id) - æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªä¸“è¾‘åªèƒ½æ”¶è—ä¸€æ¬¡

**ç´¢å¼•**:
- `idx_favorites_user_id` - user_id
- `idx_favorites_album_id` - album_id
- `idx_favorites_created_at` - created_at DESC

---

### 10. notifications (é€šçŸ¥è¡¨)

**ç”¨é€”**: ç”¨æˆ·çš„æ¶ˆæ¯é€šçŸ¥

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | UUID | PK | é€šçŸ¥ID |
| user_id | UUID | FK â†’ users, NOT NULL | æ¥æ”¶ç”¨æˆ· |
| type | VARCHAR(20) | NOT NULL | é€šçŸ¥ç±»å‹ |
| title | VARCHAR(255) | NOT NULL | é€šçŸ¥æ ‡é¢˜ |
| content | TEXT | NOT NULL | é€šçŸ¥å†…å®¹ |
| link | TEXT | NULL | ç›¸å…³é“¾æ¥ |
| is_read | BOOLEAN | DEFAULT FALSE | æ˜¯å¦å·²è¯» |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |

**é€šçŸ¥ç±»å‹**:
- `reply` - å›å¤é€šçŸ¥
- `like` - ç‚¹èµé€šçŸ¥
- `system` - ç³»ç»Ÿé€šçŸ¥

**ç´¢å¼•**:
- `idx_notifications_user_id` - user_id
- `idx_notifications_is_read` - (user_id, is_read)
- `idx_notifications_created_at` - created_at DESC
- `idx_notifications_type` - type

---

## ğŸ” è§†å›¾ (Views)

### 1. album_details

**ç”¨é€”**: ä¸“è¾‘è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«å®é™…æ­Œæ›²æ•°å’Œæ”¶è—æ•°

```sql
SELECT 
    a.*,
    COUNT(DISTINCT s.id) as actual_song_count,
    COUNT(DISTINCT f.id) as favorite_count
FROM albums a
LEFT JOIN songs s ON a.id = s.album_id
LEFT JOIN favorites f ON a.id = f.album_id
GROUP BY a.id
```

### 2. post_details

**ç”¨é€”**: å¸–å­è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«ç”¨æˆ·ã€ç‰ˆå—å’Œå…³è”ä¸“è¾‘ä¿¡æ¯

```sql
SELECT 
    p.*,
    u.username,
    u.avatar as user_avatar,
    fc.name as category_name,
    a.title as related_album_title,
    a.artist as related_album_artist
FROM posts p
LEFT JOIN users u ON p.user_id = u.id
LEFT JOIN forum_categories fc ON p.category_id = fc.id
LEFT JOIN albums a ON p.related_album_id = a.id
```

### 3. album_comment_details

**ç”¨é€”**: ä¸“è¾‘è¯„è®ºè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯

```sql
SELECT 
    ac.*,
    u.username,
    u.avatar as user_avatar
FROM album_comments ac
LEFT JOIN users u ON ac.user_id = u.id
```

---

## âš¡ è§¦å‘å™¨ (Triggers)

### 1. è‡ªåŠ¨æ›´æ–° updated_at

**åº”ç”¨è¡¨**: users, albums, songs, album_ratings, album_comments, forum_categories, posts, post_replies

**åŠŸèƒ½**: ä»»ä½•æ›´æ–°æ“ä½œéƒ½ä¼šè‡ªåŠ¨è®¾ç½® `updated_at = NOW()`

### 2. æ›´æ–°ä¸“è¾‘è¯„åˆ†

**è§¦å‘è¡¨**: album_ratings

**åŠŸèƒ½**: 
- INSERT/UPDATE/DELETE æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—ä¸“è¾‘çš„å¹³å‡åˆ†å’Œè¯„åˆ†äººæ•°
- æ›´æ–° albums è¡¨çš„ `rating` å’Œ `rating_count` å­—æ®µ

### 3. æ›´æ–°å¸–å­å›å¤æ•°

**è§¦å‘è¡¨**: post_replies

**åŠŸèƒ½**:
- INSERT/DELETE æ—¶è‡ªåŠ¨æ›´æ–°å¸–å­çš„å›å¤æ•°
- æ›´æ–° posts è¡¨çš„ `reply_count` å­—æ®µ

### 4. æ›´æ–°ä¸“è¾‘æ­Œæ›²æ•°

**è§¦å‘è¡¨**: songs

**åŠŸèƒ½**:
- INSERT/DELETE æ—¶è‡ªåŠ¨æ›´æ–°ä¸“è¾‘çš„æ­Œæ›²æ•°
- æ›´æ–° albums è¡¨çš„ `song_count` å­—æ®µ

---

## ğŸ”’ Row Level Security (RLS)

æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº† RLSï¼Œæƒé™ç­–ç•¥å¦‚ä¸‹ï¼š

### å…¬å¼€å¯è¯»è¡¨
- albums
- songs
- album_ratings
- album_comments
- forum_categories
- posts
- post_replies

### ç”¨æˆ·ç§æœ‰è¡¨
- favorites (åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„æ”¶è—)
- notifications (åªèƒ½æŸ¥çœ‹å’Œæ›´æ–°è‡ªå·±çš„é€šçŸ¥)

### ç”¨æˆ·å¯ç®¡ç†è‡ªå·±çš„å†…å®¹
- album_ratings (CRUDè‡ªå·±çš„è¯„åˆ†)
- album_comments (CRUDè‡ªå·±çš„è¯„è®º)
- posts (CRUDè‡ªå·±çš„å¸–å­)
- post_replies (CRUDè‡ªå·±çš„å›å¤)
- users (æ›´æ–°è‡ªå·±çš„ä¿¡æ¯)

### ç®¡ç†å‘˜æƒé™
- albums (å®Œå…¨ç®¡ç†)
- songs (å®Œå…¨ç®¡ç†)
- forum_categories (å®Œå…¨ç®¡ç†)
- posts (å¯ä»¥åˆ é™¤ä»»ä½•å¸–å­)
- album_comments (å¯ä»¥åˆ é™¤ä»»ä½•è¯„è®º)
- post_replies (å¯ä»¥åˆ é™¤ä»»ä½•å›å¤)

---

## ğŸ› ï¸ è‡ªå®šä¹‰å‡½æ•°

### 1. search_albums

**åŠŸèƒ½**: æœç´¢å’Œç­›é€‰ä¸“è¾‘

**å‚æ•°**:
- `search_query` TEXT - æœç´¢å…³é”®è¯
- `genre_filter` TEXT - æµæ´¾ç­›é€‰
- `year_filter` INTEGER - å¹´ä»½ç­›é€‰
- `sort_by` TEXT - æ’åºæ–¹å¼ (releaseDate/rating/popular)
- `page_num` INTEGER - é¡µç 
- `page_size` INTEGER - æ¯é¡µæ•°é‡

**è¿”å›**: ä¸“è¾‘åˆ—è¡¨å’Œæ€»æ•°

### 2. get_user_stats

**åŠŸèƒ½**: è·å–ç”¨æˆ·çš„ç»Ÿè®¡ä¿¡æ¯

**å‚æ•°**:
- `target_user_id` UUID - ç›®æ ‡ç”¨æˆ·ID

**è¿”å›**:
- `post_count` - å‘å¸–æ•°
- `reply_count` - å›å¤æ•°
- `comment_count` - è¯„è®ºæ•°
- `favorite_count` - æ”¶è—æ•°
- `rating_count` - è¯„åˆ†æ•°

---

## ğŸ“ˆ æ•°æ®æµå›¾

### ç”¨æˆ·è¯„åˆ†ä¸“è¾‘æµç¨‹
```
ç”¨æˆ·æ“ä½œ â†’ album_ratings è¡¨
    â†“
è§¦å‘å™¨: update_album_rating
    â†“
æ›´æ–° albums è¡¨çš„ rating å’Œ rating_count
```

### ç”¨æˆ·å‘å¸–æµç¨‹
```
ç”¨æˆ·æ“ä½œ â†’ posts è¡¨
    â†“
å…¶ä»–ç”¨æˆ·å›å¤ â†’ post_replies è¡¨
    â†“
è§¦å‘å™¨: update_post_reply_count
    â†“
æ›´æ–° posts è¡¨çš„ reply_count
```

### æ·»åŠ æ­Œæ›²æµç¨‹
```
ç®¡ç†å‘˜æ“ä½œ â†’ songs è¡¨
    â†“
è§¦å‘å™¨: update_album_song_count
    â†“
æ›´æ–° albums è¡¨çš„ song_count
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç´¢å¼•ç­–ç•¥
1. **ä¸»é”®ç´¢å¼•**: æ‰€æœ‰è¡¨éƒ½æœ‰ UUID ä¸»é”®
2. **å¤–é”®ç´¢å¼•**: æ‰€æœ‰å¤–é”®å­—æ®µéƒ½æœ‰ç´¢å¼•
3. **æŸ¥è¯¢ç´¢å¼•**: å¸¸ç”¨æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ created_at, rating, likesï¼‰éƒ½æœ‰ç´¢å¼•
4. **å…¨æ–‡æœç´¢ç´¢å¼•**: albums.title, songs.title, posts.title, posts.content éƒ½æœ‰ GIN ç´¢å¼•
5. **å¤åˆç´¢å¼•**: å¸¸è§çš„ç»„åˆæŸ¥è¯¢ï¼ˆå¦‚ is_pinned + created_atï¼‰æœ‰å¤åˆç´¢å¼•

### æŸ¥è¯¢ä¼˜åŒ–
1. ä½¿ç”¨è§†å›¾é¢„å…ˆ JOIN å¸¸ç”¨çš„å…³è”æ•°æ®
2. è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤èšåˆå­—æ®µï¼Œé¿å…å®æ—¶è®¡ç®—
3. RLS ç­–ç•¥ä½¿ç”¨é«˜æ•ˆçš„å­æŸ¥è¯¢
4. åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ LIMIT å’Œ OFFSET

---

## ğŸ”„ æ•°æ®åŒæ­¥å’Œä¸€è‡´æ€§

### çº§è”åˆ é™¤
- åˆ é™¤ç”¨æˆ· â†’ çº§è”åˆ é™¤å…¶æ‰€æœ‰æ•°æ®
- åˆ é™¤ä¸“è¾‘ â†’ çº§è”åˆ é™¤å…¶æ­Œæ›²ã€è¯„åˆ†ã€è¯„è®ºã€æ”¶è—
- åˆ é™¤å¸–å­ â†’ çº§è”åˆ é™¤å…¶å›å¤
- åˆ é™¤è¯„è®º/å›å¤ â†’ çº§è”åˆ é™¤å…¶å­è¯„è®º/å­å›å¤

### çº¦æŸæ£€æŸ¥
- CHECK çº¦æŸç¡®ä¿æ•°æ®èŒƒå›´æœ‰æ•ˆï¼ˆå¦‚è¯„åˆ†1-5æ˜Ÿï¼‰
- UNIQUE çº¦æŸé˜²æ­¢é‡å¤ï¼ˆå¦‚ç”¨æˆ·åã€é‚®ç®±ï¼‰
- NOT NULL çº¦æŸç¡®ä¿å¿…å¡«å­—æ®µ
- å¤–é”®çº¦æŸç¡®ä¿å¼•ç”¨å®Œæ•´æ€§

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### å¼€å‘é˜¶æ®µ
1. ä½¿ç”¨ `supabase_test_data.sql` æ’å…¥æµ‹è¯•æ•°æ®
2. åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„ Supabase é¡¹ç›®
3. é¢‘ç¹å¤‡ä»½æ•°æ®åº“

### ç”Ÿäº§ç¯å¢ƒ
1. å®šæœŸå¤‡ä»½æ•°æ®åº“
2. ç›‘æ§æ•°æ®åº“æ€§èƒ½
3. æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ç´¢å¼•
4. å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆå¦‚å·²è¯»é€šçŸ¥ï¼‰
5. ç›‘æ§ RLS ç­–ç•¥çš„æ€§èƒ½å½±å“

### æ‰©å±•å»ºè®®
1. è€ƒè™‘æ·»åŠ ç¼“å­˜å±‚ï¼ˆRedisï¼‰å‡è½»æ•°æ®åº“å‹åŠ›
2. å¯¹çƒ­é—¨æ•°æ®è¿›è¡Œé¢„åŠ è½½
3. å®ç°æ•°æ®åˆ†é¡µå’Œæ‡’åŠ è½½
4. ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºï¼ˆå°é¢å›¾ã€éŸ³é¢‘æ–‡ä»¶ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-21  
**ç»´æŠ¤è€…**: AIè¿›åŒ–è®º-èŠ±ç”Ÿ

