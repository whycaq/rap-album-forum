# ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

## âš¡ ç«‹å³å¼€å§‹ï¼ˆ3æ­¥å®Œæˆï¼‰

### ç¬¬1æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ1åˆ†é’Ÿï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ° .env æ–‡ä»¶
VITE_SUPABASE_URL=https://kpaeljhvwqqqydrtltyj.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwYWVsamh2d3FxcXlkcnRsdHlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTA4NDUsImV4cCI6MjA3NjU2Njg0NX0.Uj-8-8m3OER0KkWkqL3GqoCLiOZr5acqWmzG35k6kUM
VITE_API_BASE_URL=https://kpaeljhvwqqqydrtltyj.supabase.co
VITE_APP_NAME=è¯´å”±ä¸“è¾‘è®ºå›
VITE_APP_VERSION=1.0.0
NODE_ENV=development
```

### ç¬¬2æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
npm run dev
```

### ç¬¬3æ­¥ï¼šæµ‹è¯•è¿æ¥ï¼ˆ1åˆ†é’Ÿï¼‰

æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173

åœ¨æµè§ˆå™¨æ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š`âœ… Supabase è¿æ¥æˆåŠŸ`

---

## ğŸ¯ æ•°æ®åº“å·²å®Œæˆé…ç½®

âœ… **10ä¸ªæ ¸å¿ƒè¡¨** - æ‰€æœ‰è¡¨éƒ½å·²åˆ›å»º  
âœ… **57ä¸ªç´¢å¼•** - æ€§èƒ½ä¼˜åŒ–å®Œæˆ  
âœ… **11ä¸ªè§¦å‘å™¨** - è‡ªåŠ¨åŒ–åŠŸèƒ½å¯ç”¨  
âœ… **3ä¸ªè§†å›¾** - å¸¸ç”¨æŸ¥è¯¢ä¼˜åŒ–  
âœ… **2ä¸ªå‡½æ•°** - æœç´¢å’Œç»Ÿè®¡åŠŸèƒ½  
âœ… **30+ä¸ªRLSç­–ç•¥** - å®‰å…¨æ§åˆ¶å®Œå–„  
âœ… **5ä¸ªè®ºå›ç‰ˆå—** - åˆå§‹æ•°æ®å°±ç»ª  

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•1ï¼šæŸ¥çœ‹è®ºå›ç‰ˆå—

```typescript
import { supabase, TABLES } from '@/utils/supabase'

const { data, error } = await supabase
  .from(TABLES.FORUM_CATEGORIES)
  .select('*')
  .order('sort_order')

console.log('è®ºå›ç‰ˆå—:', data)
// åº”è¯¥è¿”å›5ä¸ªç‰ˆå—ï¼šä¸“è¾‘è®¨è®ºã€æ­Œæ›²æ•…äº‹ã€è¯´å”±æ–‡åŒ–ã€æ–°äººæ¨èã€ç«™åŠ¡å…¬å‘Š
```

### æµ‹è¯•2ï¼šæµ‹è¯•ç”¨æˆ·æ³¨å†Œ

```typescript
const { data, error } = await supabase.auth.signUp({
  email: 'test@example.com',
  password: 'test123456'
})

console.log('æ³¨å†Œç»“æœ:', data)
```

### æµ‹è¯•3ï¼šæµ‹è¯•æœç´¢åŠŸèƒ½

```typescript
const { data, error } = await supabase.rpc('search_albums', {
  search_query: '',
  page_num: 1,
  page_size: 20
})

console.log('ä¸“è¾‘æœç´¢:', data)
```

---

## ğŸ“ å¯é€‰ï¼šæ’å…¥æµ‹è¯•æ•°æ®

å¦‚æœæƒ³è¦ä¸€äº›æµ‹è¯•ä¸“è¾‘æ•°æ®ï¼Œåœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

1. è®¿é—® https://supabase.com/dashboard/project/kpaeljhvwqqqydrtltyj/editor
2. ç‚¹å‡» "New Query"
3. å¤åˆ¶ `supabase_test_data.sql` çš„å†…å®¹
4. ç‚¹å‡» "Run" æ‰§è¡Œ

ä½ å°†è·å¾—ï¼š
- 6å¼ ç»å…¸è¯´å”±ä¸“è¾‘ï¼ˆEminemã€Nasã€Kendrick Lamarç­‰ï¼‰
- 15é¦–æµ‹è¯•æ­Œæ›²

---

## ğŸ¨ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### 1. å®ç°ç”¨æˆ·è®¤è¯ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

ä¿®æ”¹ `src/views/User/Login.vue` å’Œ `Register.vue`ï¼Œä½¿ç”¨çœŸå®çš„ Supabase Authï¼š

```typescript
// Login.vue
const handleLogin = async () => {
  const { data, error } = await supabase.auth.signInWithPassword({
    email: form.username, // æˆ–ä½¿ç”¨é‚®ç®±å­—æ®µ
    password: form.password
  })
  
  if (error) {
    ElMessage.error('ç™»å½•å¤±è´¥: ' + error.message)
    return
  }
  
  ElMessage.success('ç™»å½•æˆåŠŸï¼')
  router.push('/')
}
```

### 2. å¼€å‘ä¸“è¾‘åˆ—è¡¨é¡µï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

ä¿®æ”¹ `src/views/Album/AlbumList.vue`ï¼š

```typescript
import { supabase, TABLES } from '@/utils/supabase'

const albums = ref([])
const loading = ref(false)

const loadAlbums = async () => {
  loading.value = true
  const { data, error } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
    .order('release_date', { ascending: false })
    .limit(20)
  
  if (error) {
    ElMessage.error('åŠ è½½å¤±è´¥')
    return
  }
  
  albums.value = data
  loading.value = false
}

onMounted(() => {
  loadAlbums()
})
```

### 3. å®ç°ä¸“è¾‘è¯¦æƒ…é¡µï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

ä¿®æ”¹ `src/views/Album/AlbumDetail.vue`ï¼š

```typescript
const loadAlbumDetail = async (albumId: string) => {
  // è·å–ä¸“è¾‘ä¿¡æ¯
  const { data: album } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
    .eq('id', albumId)
    .single()
  
  // è·å–æ­Œæ›²åˆ—è¡¨
  const { data: songs } = await supabase
    .from(TABLES.SONGS)
    .select('*')
    .eq('album_id', albumId)
    .order('track_number')
  
  // è·å–è¯„è®º
  const { data: comments } = await supabase
    .from('album_comment_details') // ä½¿ç”¨è§†å›¾
    .select('*')
    .eq('album_id', albumId)
    .order('created_at', { ascending: false })
}
```

### 4. å®ç°è®ºå›åŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

ä¿®æ”¹ `src/views/Forum/index.vue`ï¼š

```typescript
const loadPosts = async () => {
  const { data } = await supabase
    .from('post_details') // ä½¿ç”¨è§†å›¾
    .select('*')
    .order('created_at', { ascending: false })
    .limit(20)
  
  posts.value = data
}
```

---

## ğŸ’¡ å¼€å‘æŠ€å·§

### æŠ€å·§1ï¼šä½¿ç”¨Composableç®€åŒ–ä»£ç 

```typescript
// ä½¿ç”¨å·²æœ‰çš„ useRequest
import { useRequest } from '@/composables'

const { data: albums, loading, execute } = useRequest(async () => {
  const { data } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
  return data
})

onMounted(() => execute())
```

### æŠ€å·§2ï¼šå®æ—¶è®¢é˜…

```typescript
// ç›‘å¬æ–°è¯„è®º
const channel = supabase
  .channel('album-comments')
  .on('postgres_changes', 
    { 
      event: 'INSERT', 
      schema: 'public', 
      table: 'album_comments',
      filter: `album_id=eq.${albumId}`
    }, 
    (payload) => {
      // æ–°è¯„è®ºåˆ°è¾¾
      comments.value.unshift(payload.new)
    }
  )
  .subscribe()

// ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè®¢é˜…
onUnmounted(() => {
  supabase.removeChannel(channel)
})
```

### æŠ€å·§3ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ 

```typescript
// ä¸Šä¼ ä¸“è¾‘å°é¢
const uploadCover = async (file: File) => {
  const fileName = `${Date.now()}_${file.name}`
  
  const { data, error } = await supabase.storage
    .from('album-covers')
    .upload(fileName, file)
  
  if (error) throw error
  
  // è·å–å…¬å¼€URL
  const { data: { publicUrl } } = supabase.storage
    .from('album-covers')
    .getPublicUrl(fileName)
  
  return publicUrl
}
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹RLSç­–ç•¥å½±å“

```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°
localStorage.setItem('supabase.auth.debug', 'true')

// ç„¶ååˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„è®¤è¯æ—¥å¿—
```

### æ£€æŸ¥ç”¨æˆ·çŠ¶æ€

```typescript
import { getCurrentUser, getCurrentUserProfile } from '@/utils/supabase'

// æ£€æŸ¥è®¤è¯ç”¨æˆ·
const authUser = await getCurrentUser()
console.log('Authç”¨æˆ·:', authUser)

// æ£€æŸ¥ç”¨æˆ·èµ„æ–™
const profile = await getCurrentUserProfile()
console.log('ç”¨æˆ·èµ„æ–™:', profile)
```

### SQLè°ƒè¯•

åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­æµ‹è¯•æŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SELECT tablename FROM pg_tables WHERE schemaname = 'public';

-- æŸ¥çœ‹è¡¨æ•°æ®
SELECT * FROM public.forum_categories;

-- æµ‹è¯•æœç´¢å‡½æ•°
SELECT * FROM search_albums('', NULL, NULL, 'rating', 1, 20);

-- æŸ¥çœ‹è§¦å‘å™¨
SELECT * FROM information_schema.triggers WHERE trigger_schema = 'public';
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **SUPABASE_CONFIG.md** - å®Œæ•´é…ç½®è¯´æ˜
- **æ•°æ®åº“æ¶æ„æ€»ç»“.md** - æŠ€æœ¯æ–‡æ¡£
- **å¼€å‘æŒ‡å—.md** - å¼€å‘è§„èŒƒ
- **éœ€æ±‚æ–‡æ¡£.md** - åŠŸèƒ½éœ€æ±‚

---

## â“ å¸¸è§é—®é¢˜

### Q: RLSç­–ç•¥é˜»æ­¢äº†æˆ‘çš„æ“ä½œï¼Ÿ
**A**: ç¡®ä¿ï¼š
1. ç”¨æˆ·å·²ç™»å½•
2. åœ¨ `public.users` è¡¨ä¸­åˆ›å»ºäº†å¯¹åº”è®°å½•
3. `auth_id` å­—æ®µæ­£ç¡®å…³è”

### Q: å¦‚ä½•åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Ÿ
**A**: 
```sql
-- åœ¨ SQL Editor ä¸­æ‰§è¡Œ
UPDATE public.users 
SET role = 'admin' 
WHERE email = 'your-email@example.com';
```

### Q: æŸ¥è¯¢å¾ˆæ…¢ï¼Ÿ
**A**: 
1. ä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡ŒæŸ¥è¯¢
2. ä½¿ç”¨è§†å›¾æ›¿ä»£å¤æ‚ JOIN
3. æ·»åŠ åˆ†é¡µé™åˆ¶

---

## ğŸ‰ å¼€å§‹å¼€å‘å§ï¼

ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œç°åœ¨å¯ä»¥å¼€å§‹å¼€å‘ä½ çš„è¯´å”±ä¸“è¾‘è®ºå›äº†ï¼

**é¡¹ç›®çŠ¶æ€**: âœ… å°±ç»ª  
**æ•°æ®åº“**: âœ… é…ç½®å®Œæˆ  
**ç¯å¢ƒ**: âœ… å¼€å‘ç¯å¢ƒ  
**æ–‡æ¡£**: âœ… å®Œæ•´é½å…¨  

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€

---

**æ›´æ–°æ—¶é—´**: 2025-10-21  
**é¡¹ç›®**: rap_album_forum

