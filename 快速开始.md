# 🚀 快速开始指南

## ⚡ 立即开始（3步完成）

### 第1步：配置环境变量（1分钟）

在项目根目录创建 `.env` 文件：

```bash
# 复制以下内容到 .env 文件
VITE_SUPABASE_URL=https://kpaeljhvwqqqydrtltyj.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwYWVsamh2d3FxcXlkcnRsdHlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTA4NDUsImV4cCI6MjA3NjU2Njg0NX0.Uj-8-8m3OER0KkWkqL3GqoCLiOZr5acqWmzG35k6kUM
VITE_API_BASE_URL=https://kpaeljhvwqqqydrtltyj.supabase.co
VITE_APP_NAME=说唱专辑论坛
VITE_APP_VERSION=1.0.0
NODE_ENV=development
```

### 第2步：启动开发服务器（1分钟）

```bash
npm run dev
```

### 第3步：测试连接（1分钟）

打开浏览器访问 http://localhost:5173

在浏览器控制台应该看到：`✅ Supabase 连接成功`

---

## 🎯 数据库已完成配置

✅ **10个核心表** - 所有表都已创建  
✅ **57个索引** - 性能优化完成  
✅ **11个触发器** - 自动化功能启用  
✅ **3个视图** - 常用查询优化  
✅ **2个函数** - 搜索和统计功能  
✅ **30+个RLS策略** - 安全控制完善  
✅ **5个论坛版块** - 初始数据就绪  

---

## 🧪 快速测试

### 测试1：查看论坛版块

```typescript
import { supabase, TABLES } from '@/utils/supabase'

const { data, error } = await supabase
  .from(TABLES.FORUM_CATEGORIES)
  .select('*')
  .order('sort_order')

console.log('论坛版块:', data)
// 应该返回5个版块：专辑讨论、歌曲故事、说唱文化、新人推荐、站务公告
```

### 测试2：测试用户注册

```typescript
const { data, error } = await supabase.auth.signUp({
  email: 'test@example.com',
  password: 'test123456'
})

console.log('注册结果:', data)
```

### 测试3：测试搜索功能

```typescript
const { data, error } = await supabase.rpc('search_albums', {
  search_query: '',
  page_num: 1,
  page_size: 20
})

console.log('专辑搜索:', data)
```

---

## 📝 可选：插入测试数据

如果想要一些测试专辑数据，在 Supabase SQL Editor 中执行：

1. 访问 https://supabase.com/dashboard/project/kpaeljhvwqqqydrtltyj/editor
2. 点击 "New Query"
3. 复制 `supabase_test_data.sql` 的内容
4. 点击 "Run" 执行

你将获得：
- 6张经典说唱专辑（Eminem、Nas、Kendrick Lamar等）
- 15首测试歌曲

---

## 🎨 下一步开发建议

### 1. 实现用户认证（优先级：高）

修改 `src/views/User/Login.vue` 和 `Register.vue`，使用真实的 Supabase Auth：

```typescript
// Login.vue
const handleLogin = async () => {
  const { data, error } = await supabase.auth.signInWithPassword({
    email: form.username, // 或使用邮箱字段
    password: form.password
  })
  
  if (error) {
    ElMessage.error('登录失败: ' + error.message)
    return
  }
  
  ElMessage.success('登录成功！')
  router.push('/')
}
```

### 2. 开发专辑列表页（优先级：高）

修改 `src/views/Album/AlbumList.vue`：

```typescript
import { supabase, TABLES } from '@/utils/supabase'

const albums = ref([])
const loading = ref(false)

const loadAlbums = async () => {
  loading.value = true
  const { data, error } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
    .order('release_date', { ascending: false })
    .limit(20)
  
  if (error) {
    ElMessage.error('加载失败')
    return
  }
  
  albums.value = data
  loading.value = false
}

onMounted(() => {
  loadAlbums()
})
```

### 3. 实现专辑详情页（优先级：高）

修改 `src/views/Album/AlbumDetail.vue`：

```typescript
const loadAlbumDetail = async (albumId: string) => {
  // 获取专辑信息
  const { data: album } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
    .eq('id', albumId)
    .single()
  
  // 获取歌曲列表
  const { data: songs } = await supabase
    .from(TABLES.SONGS)
    .select('*')
    .eq('album_id', albumId)
    .order('track_number')
  
  // 获取评论
  const { data: comments } = await supabase
    .from('album_comment_details') // 使用视图
    .select('*')
    .eq('album_id', albumId)
    .order('created_at', { ascending: false })
}
```

### 4. 实现论坛功能（优先级：中）

修改 `src/views/Forum/index.vue`：

```typescript
const loadPosts = async () => {
  const { data } = await supabase
    .from('post_details') // 使用视图
    .select('*')
    .order('created_at', { ascending: false })
    .limit(20)
  
  posts.value = data
}
```

---

## 💡 开发技巧

### 技巧1：使用Composable简化代码

```typescript
// 使用已有的 useRequest
import { useRequest } from '@/composables'

const { data: albums, loading, execute } = useRequest(async () => {
  const { data } = await supabase
    .from(TABLES.ALBUMS)
    .select('*')
  return data
})

onMounted(() => execute())
```

### 技巧2：实时订阅

```typescript
// 监听新评论
const channel = supabase
  .channel('album-comments')
  .on('postgres_changes', 
    { 
      event: 'INSERT', 
      schema: 'public', 
      table: 'album_comments',
      filter: `album_id=eq.${albumId}`
    }, 
    (payload) => {
      // 新评论到达
      comments.value.unshift(payload.new)
    }
  )
  .subscribe()

// 组件卸载时取消订阅
onUnmounted(() => {
  supabase.removeChannel(channel)
})
```

### 技巧3：处理文件上传

```typescript
// 上传专辑封面
const uploadCover = async (file: File) => {
  const fileName = `${Date.now()}_${file.name}`
  
  const { data, error } = await supabase.storage
    .from('album-covers')
    .upload(fileName, file)
  
  if (error) throw error
  
  // 获取公开URL
  const { data: { publicUrl } } = supabase.storage
    .from('album-covers')
    .getPublicUrl(fileName)
  
  return publicUrl
}
```

---

## 🔍 调试技巧

### 查看RLS策略影响

```typescript
// 在浏览器控制台
localStorage.setItem('supabase.auth.debug', 'true')

// 然后刷新页面，可以看到详细的认证日志
```

### 检查用户状态

```typescript
import { getCurrentUser, getCurrentUserProfile } from '@/utils/supabase'

// 检查认证用户
const authUser = await getCurrentUser()
console.log('Auth用户:', authUser)

// 检查用户资料
const profile = await getCurrentUserProfile()
console.log('用户资料:', profile)
```

### SQL调试

在 Supabase Dashboard 的 SQL Editor 中测试查询：

```sql
-- 查看所有表
SELECT tablename FROM pg_tables WHERE schemaname = 'public';

-- 查看表数据
SELECT * FROM public.forum_categories;

-- 测试搜索函数
SELECT * FROM search_albums('', NULL, NULL, 'rating', 1, 20);

-- 查看触发器
SELECT * FROM information_schema.triggers WHERE trigger_schema = 'public';
```

---

## 📚 参考文档

- **SUPABASE_CONFIG.md** - 完整配置说明
- **数据库架构总结.md** - 技术文档
- **开发指南.md** - 开发规范
- **需求文档.md** - 功能需求

---

## ❓ 常见问题

### Q: RLS策略阻止了我的操作？
**A**: 确保：
1. 用户已登录
2. 在 `public.users` 表中创建了对应记录
3. `auth_id` 字段正确关联

### Q: 如何创建管理员用户？
**A**: 
```sql
-- 在 SQL Editor 中执行
UPDATE public.users 
SET role = 'admin' 
WHERE email = 'your-email@example.com';
```

### Q: 查询很慢？
**A**: 
1. 使用索引字段进行查询
2. 使用视图替代复杂 JOIN
3. 添加分页限制

---

## 🎉 开始开发吧！

一切准备就绪，现在可以开始开发你的说唱专辑论坛了！

**项目状态**: ✅ 就绪  
**数据库**: ✅ 配置完成  
**环境**: ✅ 开发环境  
**文档**: ✅ 完整齐全  

祝开发顺利！🚀

---

**更新时间**: 2025-10-21  
**项目**: rap_album_forum

